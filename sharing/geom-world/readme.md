# GEOM-WORLD
[Remi van Trijp](mailto:remi.vantrijp@sony.com) -
*Sony Computer Science Laboratories, Paris Lab*

**Summary**

GEOM-WORLD is a scene generator that simulates scenes in the style of the Talking Heads experiment, developed by Luc Steels and colleagues at the VUB Artificial Intelligence Laboratory in Brussels and the Sony Computer Science Laboratories, Paris Lab. The original scenes consisted of colored geommetric shapes on a whiteboard, captured by Sony pan-tilt cameras. For further reading about the Talking Heads experiment, please check out this open access book: 

> Steels, Luc (2015). *The Talking Heads Experiment: Origins of Words and Meanings.* Berlin: Language Science Press. DOI: [10.17169/FUDOCS_document_000000022455](https://refubium.fu-berlin.de/handle/fub188/19059). [[alternative link]](https://langsci-press.org/catalog/book/49)


**Installing and Using GEOM-WORLD**

* Please check run-demo.lisp with instructions for using GEOM-WORLD.
* GEOM-WORLD heavily uses the :opticl image processing library. It is highly recommended to check [its documentation](https://github.com/slyrus/opticl) if you want to understand and/or customize the code in more detail.
 
## 1. Classes

###geom-world

This class defines the shapes and colors that are used by default for generating objects:

* Shapes: circle, triangle, rectangle, square
* Colors: RGB values with a description (Red, Green, Blue and Yellow)

###geom-scene

Each scene is an image that is generated by using the blank image file 
`/images/base-image.png`

A scene is described using the following slots:

* area: the surface on which objects may appear
* image: the image path
* width: width of the image
* height: height of the image
* objects: the objects in the image/scene

##geom-object

Each object that may appear in the image must subclass from the base class `geom-object`, which is implemented as a subclass of the IRL class `entity` (which is convenient for reusing IRL's web interface facilities). Each object is described using the following slots:

* area: surface area of a segment
* bounding-box: describes a rectangular box to define the outer boundaries of the object
* HPOS: horizontal position, measured as the mid-x-value
* VPOS: vertical position, measured as the mid-y-value
* color: color of the object
* edge-count: number of edges of the object (e.g. 4 for a square)

Currently, there are four subclasses that define different shapes:

* geom-circle (which adds a radius slot)
* geom-rectangle (edge-count = 4)
* geom-square (a subclass of geom-rectangle)
* geom-triangle (which adds more information about its edges)

## 2. Scene Generator

The file `scene-generator.lisp` contains all functions and methods for generating objects and scenes. The code distinguishes between the generation of the objects and drawing them.

### geom-generate-object *(shape max-bounding-box world)*

A generic function for generating objects. Its arguments are:

* Shape: a symbol (e.g. `'square`)
* Max-bounding-box: a list of four values:
	* Smallest x-coordinate (leftmost point)
	* Smallest y-coordinate (lowest point)
	* Upper x-coordinate (rightmost point)
	* Upper y-coordinate (highest point)
* geom-world: an instance of the geom-world class

### geom-draw-shape *(shape image)*

A generic function for drawing the shape (an object) onto an image. The specialized methods reuse functions from the `:opticl` image processing library as much as possible. In the case of triangles, a custom algorithm fills the triangle pixle by pixle, which can be a relatively slow process.

### geom-generate-scene *(&key experiment file-prefix display? reset)*

Function that generates and returns a `geom-scene` object. As a side effect, it will also generate and write a PNG-file of the scene; and depending on the parameters you provide, it will also display the generated image in the web interface. You can control the behavior of the scene generator with the following keywords:

* `experiment` *(optional)*: If an `experiment` object from the Babel experiment framework is provided, it must include a configuration for `:min-nr-of-objects` and `:max-nr-of-objects`. If nothing is provided, the generated scene will include minimally two and maximally five objects.
* `file-prefix`  *(optional)*: The generated scene will be stored as a PNG-file. If you want to customize the file name, please specify a prefix (a symbol), otherwise a random symbol is generated.
* `display?`: If set to T (default value), the generated image will be displayed in the web interface.
* `reset`: If set to T (default value is NIL), the web interface will be reset before the image is displayed.

### geom-generate-scenes

Function that can be used for generating multiple scenes at the same time. All of these scenes will be returned as a list, and the corresponding images will be written to the specified path (see run-demo.lisp for more).



## 3. Helper Functions

The file `helper-functions.lisp` contains some useful functions. These are not exported:

* `geom-select-shape`: randomly selects a shape to generate
* `geom-color-pixel`: colors a pixel of an image
* `inside-triangle-p`: computes whether a point is within the bounds of a triangle
* `calculate-midposition`: returns the hpos and vpos of a bounding box
* `ensure-minimal-length`: function that can be tweaked to ensure that images are not too small to be useful
* `image-width`: get the width of an image represented as an array
* `image-height`: get the height of an image represented as an array
* `geom-area`: a generic function for calculating the area of a shape. To be customized if you add new shapes.